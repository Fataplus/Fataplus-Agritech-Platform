# Cloudflare Workers configuration for Fataplus Backend API
name = "fataplus-api"
main = "src/worker.js"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Account configuration
account_id = "f30dd0d409679ae65e841302cc0caa8c"

# Environment variables
[vars]
ENVIRONMENT = "production"
LOG_LEVEL = "info"
CORS_ORIGINS = "https://fataplus.com,https://app.fataplus.com"

# D1 Database bindings (utilisant les bases existantes)
[[d1_databases]]
binding = "DB"
database_name = "fataplus-app"
database_id = "51ccc3a9-b4ca-4250-812d-65c9eebc4111"

# KV namespace bindings (utilisant les namespaces existants)
[[kv_namespaces]]
binding = "CACHE"
id = "5411019ff86f410a98f4616ce775d081"
preview_id = "5411019ff86f410a98f4616ce775d081"

[[kv_namespaces]]
binding = "APP_DATA"
id = "a1ab5e29ebde43e39ce68db5715d78c7"
preview_id = "d4d9d34331644d1e9ec82521819e38be"

# Analytics engine bindings
[[analytics_engine_datasets]]
binding = "ANALYTICS"

# AI bindings for Cloudflare Workers AI
[ai]
binding = "AI"

# Environment-specific configurations
[env.staging]
name = "fataplus-api-staging"

[env.staging.vars]
ENVIRONMENT = "staging"
LOG_LEVEL = "debug"
CORS_ORIGINS = "https://staging.fataplus.com,https://*.pages.dev"

# Staging D1 Database
[[env.staging.d1_databases]]
binding = "DB"
database_name = "fataplus-app"
database_id = "51ccc3a9-b4ca-4250-812d-65c9eebc4111"

# Staging KV namespaces
[[env.staging.kv_namespaces]]
binding = "CACHE"
id = "5411019ff86f410a98f4616ce775d081"
preview_id = "5411019ff86f410a98f4616ce775d081"

[[env.staging.kv_namespaces]]
binding = "APP_DATA"
id = "a1ab5e29ebde43e39ce68db5715d78c7"
preview_id = "d4d9d34331644d1e9ec82521819e38be"

# Staging Analytics
[[env.staging.analytics_engine_datasets]]
binding = "ANALYTICS"

# Staging AI
[env.staging.ai]
binding = "AI"

# AutoRAG Configuration - Vectorize
[[vectorize]]
binding = "VECTORIZE"
index_name = "fataplus-knowledge-base"

# Staging Vectorize
[[env.staging.vectorize]]
binding = "VECTORIZE"
index_name = "fataplus-knowledge-base"
